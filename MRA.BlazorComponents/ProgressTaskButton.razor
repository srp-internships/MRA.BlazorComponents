@inherits MudBaseButton
@if (_isFunctionRunning)
{
    <MudButton @attributes="AdditionalAttributes">
        <MudProgressCircular Indeterminate="true" Size="Size.Small"/>
    </MudButton>
}
else
{
    <MudButton OnClick="StartFunction" @attributes="AdditionalAttributes">
        @ChildContent
    </MudButton>
}

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public new EventCallback OnClick { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public IDictionary<string, object>? AdditionalAttributes { get; set; }

    private bool _isFunctionRunning;

    private async Task StartFunction()
    {
        try
        {
            _isFunctionRunning = true;
            StateHasChanged();
            await OnClick.InvokeAsync(null);
        }
        catch (Exception)
        {
            // ignored
        }
        finally
        {
            _isFunctionRunning = false;
            StateHasChanged();
        }
    }

}